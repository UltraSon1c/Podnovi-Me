/*! Copyright WeeblrPress - Weeblr,llc 2017 - Licence: http://www.gnu.org/copyleft/gpl.html GNU/GPL */
!function(e,s,a,n){"use strict";function t(){n(".js-wbamp-no-javascript").hide(),n(".wblib-settings-accordion").accordion({heightStyle:"content",collapsible:!0,active:!1});var e=n("#wblib-settings-tabs"),a=e.data("page-id"),t=wblib.page_infos.blog_id,o=s.wblib.getCookie(t+"_"+a+"_active_tab");e.tabs({activate:function(e,s){s.oldTab.find(".nav-tab").removeClass("nav-tab-active"),s.newTab.find(".nav-tab").addClass("nav-tab-active");var o=s.newTab.index();wblib.setCookie(t+"_"+a+"_active_tab",o,1/0),s.newTab.find(".js-wblib-tab-upgrade").length?n(".submit").hide():n(".submit").show()}}).fadeIn(function(){e.tabs({active:o})})}function o(e){e.preventDefault();var s=n(this),a=n("#js-wbamp-disqus-connect-msg");a.empty();var t=n("#weeblramp___weeblramp_user__access_key"),o=t.val();if(!o||o.length!=u)return void l(a,"Please enter and save your WeeblrPress access key on the <strong>System</strong> tab of this page before trying to connect to WeeblrPress.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",8e3);var r=n("#weeblramp___weeblramp_user__comment_disqus_shortname"),c=r.val();if(!c)return void l(a,"Please enter your disqus shortname first.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",4e3);var b="js-wbamp-disqus-connect-spinner",m=n("#weeblramp___weeblramp_user__comment_disqus_endpoint"),d=n("#weeblramp___weeblramp_user__disqus_connect_state"),_=d.val(),p="connected"==_?"delete":"update",w=n("#weeblramp___weeblramp_user__comment_disqus_shortname-button"),v={action:"wblib_config_action",request:p,config_item:"comment_disqus_shortname",_ajax_nonce:wblib.ajax_nonces.comment_disqus_shortname||"",shortname:c};i(a),wblib.spinner.start(b,{"class":"wbl-spinner-css-12"}),s.prop("disabled","disabled"),n.post(ajaxurl,v).done(function(e){if(wblib.spinner.stop(b),e.success)d.val(e.data.new_connect_state),"connected"==e.data.new_connect_state?(r.attr("disabled","disabled"),m.attr("disabled","disabled"),d.val("connected")):(r.removeAttr("disabled"),m.removeAttr("disabled"),m.empty(),d.val("not_connected")),m.val(e.data.new_endpoint),w.html(e.data.new_button_label),l(a,e.data.message,"wbamp-ajax-response-msg-success","wbamp-ajax-response-msg-failure",5e3);else{var n=e.data&&e.data[0]&&e.data[0].message?e.data[0].message:"Sorry we cannot contact the WeeblPress servers. Please try again later.";l(a,n,"wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success")}s.prop("disabled",!1)})}function r(e){e.preventDefault();var s=n(this),t=n("#js-wbamp-disqus-connect-msg");t.empty();var o=n("#weeblramp___weeblramp_user__comment_disqus_shortname"),r=o.val();if(!r)return void l(t,"Please enter your disqus shortname first.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",4e3);var c="js-wbamp-disqus-connect-spinner";i(t),wblib.spinner.start(c,{"class":"wbl-spinner-css-12"}),s.prop("disabled","disabled");var b=Date.now(),m=ajaxurl+"?action=wblib_config_action&request=download_relay_file&config_item=comment_disqus_shortname&shortname="+r+"&_ajax_nonce="+(wblib.ajax_nonces.comment_disqus_shortname||"")+"&id="+b;n("<iframe>").hide().prop("src",m).appendTo("body");var d=s,_=5e3,p=function(){var e=Date.now(),s=(e-b)/1e3,n="wbamp_dl_success="+b,o=a.cookie.indexOf(n)>-1;o&&console.log("Successful download, response after "+s+" seconds");var r=e>b+_;r&&(console.log("Download timed out after "+s+" seconds"),l(t,"Sorry we cannot contact the WeeblPress servers. Please try again later.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success")),o||r?(d.removeProp("disabled"),wblib.spinner.stop(c)):setTimeout(p,500)};setTimeout(p,500)}function i(e){e.hide(),w.length&&(w.forEach(function(e){e&&clearTimeout(e)}),w=[])}function c(e){n("#weeblramp___weeblramp_user__comment_disqus_shortname").removeAttr("disabled"),n("#weeblramp___weeblramp_user__comment_disqus_endpoint").removeAttr("disabled")}function l(e,s,a,n,t){e.addClass(a).removeClass(n).html(s).fadeIn(),t&&w.push(setTimeout(function(){e.empty()},t))}function b(){n(d).on("click",o),n(_).on("click",r),n(p).on("click",c)}function m(){try{t(),b()}catch(e){console.log("weeblrAMP: error setting up javascript: "+e.message)}}var d=".js-wbamp-disqus-connect-button",_=".js-wbamp-disqus-download-button",p=".js-wbamp-setting-submit",u=64,w=[];return n(a).ready(m),e}(window.weeblramp=window.weeblramp||{},window,document,jQuery);
