/*! Copyright WeeblrPress - Weeblr,llc 2017 - Licence: http://www.gnu.org/copyleft/gpl.html GNU/GPL */
!function(e,a,i,s){"use strict";function t(e){e.preventDefault();var a=s(this),i=a.prev(I).first(),t=i.attr("id"),n=a.data("media-min-width"),r=a.data("media-min-height");if(!wp.media.frames.wblib_media_manager){wp.media.frames.wblib_media_manager=wp.media({title:a.data("media-title"),multiple:!1,library:{type:a.data("media-type")},button:{text:a.data("media-button")}});var d=function(){var e=wp.media.frames.wblib_media_manager.state().get("selection");e&&e.each(function(e){var d=e.attributes.width;n&&n>d&&console.log("This image is not wide enough. Minimal width is: "+n+" pixels.");var o=e.attributes.height;r&&r>o&&console.log("This image is not wide enough. Minimal width is: "+r+" pixels.");var l=e.attributes.url;if(i.val(l),s("#"+t+"_width").val(d),s("#"+t+"_height").val(o),a.data("media-preview")){var c=s("<img />").attr("src",l),u="#js-"+t+"-preview";s(u).empty().append(c)}})};wp.media.frames.wblib_media_manager.on("select",d)}wp.media.frames.wblib_media_manager.open()}function n(){s(D).on("click",t)}function r(){s(E).wpColorPicker()}function d(){s(R).on("click",o)}function o(a){a.preventDefault();var i=s(this),t={action:"wblib_config_action",config_item:"clear_transients",_ajax_nonce:e.ajax_nonces.clear_transients||""};s("#js-wbamp-clear-transients-msg").hide(),e.spinner.start("js-wbamp-clear-transients-spinner",{"class":"wbl-spinner-css-12"}),i.prop("disabled","disabled"),s.post(ajaxurl,t).done(function(a){console.debug(a),e.spinner.stop("js-wbamp-clear-transients-spinner"),a.success?(s("#js-wbamp-clear-transients-msg").removeClass("wbamp-ajax-response-msg-failure").addClass("wbamp-ajax-response-msg-success").html(a.data).fadeIn(),setTimeout(function(){s("#js-wbamp-clear-transients-msg").hide()},5e3)):s("#js-wbamp-clear-transients-msg").removeClass("wbamp-ajax-response-msg-success").addClass("wbamp-ajax-response-msg-failure").html(a.data).fadeIn(),i.prop("disabled",!1)})}function l(){s(T).on("click",c)}function c(a){a.preventDefault();var i=s(this),t={action:"wblib_config_action",config_item:"flush_rewrite_rules",_ajax_nonce:e.ajax_nonces.flush_rewrite_rules||""};s("#js-wbamp-flush-rewrite-rules-msg").hide(),e.spinner.start("js-wbamp-flush-rewrite-rules-spinner",{"class":"wbl-spinner-css-12"}),i.prop("disabled","disabled"),s.post(ajaxurl,t).done(function(a){console.debug(a),e.spinner.stop("js-wbamp-flush-rewrite-rules-spinner"),a.success?(s("#js-wbamp-flush-rewrite-rules-msg").removeClass("wbamp-ajax-response-msg-failure").addClass("wbamp-ajax-response-msg-success").html(a.data).fadeIn(),setTimeout(function(){s("#js-wbamp-flush-rewrite-rules-msg").hide()},5e3)):s("#js-wbamp-flush-rewrite-rules-msg").removeClass("wbamp-ajax-response-msg-success").addClass("wbamp-ajax-response-msg-failure").html(a.data).fadeIn(),i.prop("disabled",!1)})}function u(){var e=s(".js-wbamp-show-if");e.each(m),p()}function m(e,a){var i={},t=s(a),n=t.attr("class"),r=n&&n.split(" ");s.each(r,function(){"js-data"==this.substr(0,7)&&(i.hideable_id=this,i.$hideable_id=s("."+this),i.data_source=this.substr(8))});var d=t.data("always_hide");if(d)return i.always_hide=!0,void U.push(i);var o=s("#"+i.data_source);o.length&&(i.show_if_id=o.data("show_if_id"),i.show_include=o.data("show_include"),i.show_include=i.show_include&&i.show_include.toString().split(" "),i.show_exclude=o.data("show_exclude"),i.show_exclude=i.show_exclude&&i.show_exclude.toString().split(" ")),i.show_if_id&&(i.$show_trigger=s("#"+i.show_if_id),i.$show_trigger.length&&i.data_source&&(i.$show_trigger.on("change",p),U.push(i)))}function p(){s.each(U,function(e,a){if(a.always_hide)return void a.$hideable_id.fadeOut();var i=a.$show_trigger.val(),t=a.$show_trigger.prop("type");if("checkbox"==t){if(-1!=s.inArray("checked",a.show_include))return void(a.$show_trigger.prop("checked")?a.$hideable_id.fadeIn():a.$hideable_id.fadeOut());if(-1!=s.inArray("unchecked",a.show_include))return void(a.$show_trigger.prop("checked")?a.$hideable_id.fadeOut():a.$hideable_id.fadeIn())}return a.show_exclude&&-1!=s.inArray(i,a.show_exclude)?void a.$hideable_id.fadeOut():void(a.show_include?-1!=s.inArray(i,a.show_include)?a.$hideable_id.fadeIn():a.$hideable_id.fadeOut():a.$hideable_id.fadeIn())})}function h(e){e.preventDefault(),O.click(),a.location="#"}function _(){if(O=s("a.js-wblib-tab-upgrade"),O.length){var e=s(".js-wblib-upgrade-link");e.on("click",h)}}function w(e,a,s,t,n){s=parseInt(s)||1/0;var r=1/0===s?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+s;t=t||"/";var d=n?"; secure":"",o=encodeURIComponent(e)+"="+encodeURIComponent(a)+r+"; path="+t+d;i.cookie=o}function b(e){return e?decodeURIComponent(i.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}function f(e){w(encodeURIComponent(e),"",-1)}function g(e){e&&e.preventDefault();var a=s(this),i=a.attr("id");return A[i]||(A[i]={url:a.attr("href"),id:a.data("id"),embed_url:a.data("embed_url"),embed_url_hash:a.data("embed_url_hash"),button_id:a.data("button_id"),frame_id:a.data("frame_id"),frame_container_id:a.data("frame_container_id"),spinner_id:a.data("spinner_id"),spinner_container_id:a.data("spinner_container_id"),hash:a.data("hash"),state:a.data("state")}),"opened"==A[i].state?void y(A[i]):(s("#js-wbamp-settings-doc-msg-"+A[i].hash).empty(),void(B[A[i].id]?C(A[i],B[A[i].id]):(v(A[i]),jQuery.ajax({url:A[i].embed_url,error:function(e,a,t){j(A[i]),console.error("Error fetching documentation page "+A[i].id+", status: "+a+", code: "+e.status),s("#js-wbamp-settings-doc-msg-"+A[i].hash).html("Sorry, could not load help from server. Please try again later."),setTimeout(function(){s("#js-wbamp-settings-doc-msg-"+A[i].hash).empty()},7e3)},success:function(e,a,s){C(A[i],e)}}))))}function v(a){s("#"+a.spinner_container_id).slideDown(),e.spinner.start(a.spinner_id)}function j(a){e.spinner.stop(a.spinner_id),s("#"+a.spinner_container_id).hide()}function x(e){e.state="opened",s("#"+e.button_id).addClass("wblib-visible"),s("#"+e.frame_id).fadeIn()}function y(e){e.state="closed",s("#"+e.frame_id).slideUp(),s("#"+e.button_id).removeClass("wblib-visible");var a=i.getElementById(e.frame_id);a&&a.parentElement.removeChild(a)}function C(e,a){var t=!1;a&&!B[e.id]&&(B[e.id]=a);var n=i.getElementById(e.frame_id);n&&n.parentElement.removeChild(n);var r=s('<iframe id="'+e.frame_id+'" class="wblib-settings-doc-frame wblib-hide"></iframe>');s("#"+e.frame_container_id).append(r),n=r[0];var d,o;n.document?d=n.document:(o=n.contentWindow)&&(d=o.document),r.on("load",function(){if(j(e),x(e),!t&&e.embed_url_hash&&d){t=!0;var a=d.getElementById(e.embed_url_hash);if(a){var i=a.getBoundingClientRect();o.scrollTo(0,i.top)}}}),d.open(),d.writeln(a),d.close()}function $(){s(".js-wblib-settings-doc-embed").click(g)}function k(){try{n(),r(),d(),l(),u(),_(),$()}catch(e){console.log("wbLib: error setting up javascript: "+e.message)}}var I=".js-wbamp-media-manager-field",D=".js-wbamp-media-manager-button",E=".js-wblib-color-picker",R=".js-wbamp-clear-transients-button",T=".js-wbamp-flush-rewrite-rules-button",U=[],O=null,A=[],B={};return s(i).ready(k),e.setCookie=w,e.getCookie=b,e.deleteCookie=f,e.doc_embed={showHelp:g,displayHelp:C},e}(window.wblib=window.wblib||{},window,document,jQuery);
